From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Summerfeeling <summerfeelingmc@gmail.com>
Date: Thu, 4 May 2023 11:42:09 +0200
Subject: [PATCH] Added VillagerGiveGiftToHeroEvent


diff --git a/src/main/java/net/minecraft/world/entity/ai/behavior/GiveGiftToHero.java b/src/main/java/net/minecraft/world/entity/ai/behavior/GiveGiftToHero.java
index 688301f43a26c8727870052945a241fa7ec184a1..418700f5e60f41ecde211add96c21bd4bea14993 100644
--- a/src/main/java/net/minecraft/world/entity/ai/behavior/GiveGiftToHero.java
+++ b/src/main/java/net/minecraft/world/entity/ai/behavior/GiveGiftToHero.java
@@ -3,6 +3,7 @@ package net.minecraft.world.entity.ai.behavior;
 import com.google.common.collect.ImmutableList;
 import com.google.common.collect.ImmutableMap;
 import com.google.common.collect.Maps;
+import java.util.ArrayList;
 import java.util.List;
 import java.util.Map;
 import java.util.Optional;
@@ -24,6 +25,9 @@ import net.minecraft.world.level.storage.loot.LootContext;
 import net.minecraft.world.level.storage.loot.LootTable;
 import net.minecraft.world.level.storage.loot.parameters.LootContextParamSets;
 import net.minecraft.world.level.storage.loot.parameters.LootContextParams;
+import org.bukkit.Bukkit;
+import org.bukkit.craftbukkit.inventory.CraftItemStack;
+import org.bukkit.event.entity.VillagerGiveGiftToHeroEvent;
 
 public class GiveGiftToHero extends Behavior<Villager> {
     private static final int THROW_GIFT_AT_DISTANCE = 5;
@@ -104,12 +108,24 @@ public class GiveGiftToHero extends Behavior<Villager> {
     }
 
     private void throwGift(Villager villager, LivingEntity recipient) {
-        for(ItemStack itemStack : this.getItemToThrow(villager)) {
-            BehaviorUtils.throwItem(villager, itemStack, recipient.position());
-        }
+        // Cheetah start - added VillagerGiveGiftToHeroEvent
+        List<ItemStack> itemStacks = this.getItemToThrow(villager);
+
+        List<org.bukkit.inventory.ItemStack> convertedItemStacks = new ArrayList<>();
+        itemStacks.forEach(itemStack -> convertedItemStacks.add(CraftItemStack.asCraftMirror(itemStack)));
+
+        VillagerGiveGiftToHeroEvent event = new VillagerGiveGiftToHeroEvent(villager.getBukkitEntity(), recipient.getBukkitLivingEntity(), convertedItemStacks);
+        Bukkit.getPluginManager().callEvent(event);
 
+        if (!event.isCancelled()) {
+            for(ItemStack itemStack : itemStacks) {
+                BehaviorUtils.throwItem(villager, itemStack, recipient.position());
+            }
+        }
+        // Cheetah end
     }
 
+
     private List<ItemStack> getItemToThrow(Villager villager) {
         if (villager.isBaby()) {
             return ImmutableList.of(new ItemStack(Items.POPPY));
